ANALYTICS_DB:
- type: NoSQLDatabase
- kind: MongoDB
- dependencies:
  - analytics_queue
  - posts_db
  - posts_cache
  - media_db
- schema:
  - fields:
    - document: postnotification.Analytics struct{PostID int64}
    - Analytics: postnotification.Analytics struct{PostID int64}
  - unfolded_fields:
    - Analytics.PostID: int64
  - foreign_fields:
    - Analytics:
      - ANALYTICS_QUEUE.TriggerAnalyticsMessage.PostID
      - MEDIA_DB.Media.PostID
      - POSTS_CACHE.key
      - POSTS_CACHE.value
      - POSTS_DB.Post.PostID
    - Analytics.PostID:
      - ANALYTICS_QUEUE.TriggerAnalyticsMessage.PostID
      - MEDIA_DB.Media.PostID
      - POSTS_CACHE.key
      - POSTS_CACHE.value
      - POSTS_DB.Post.PostID

ANALYTICS_QUEUE:
- type: Queue
- kind: RabbitMQ
- dependencies:
  - posts_db
  - posts_cache
  - media_db
- schema:
  - fields:
    - message: postnotification.TriggerAnalyticsMessage struct{PostID string}
    - TriggerAnalyticsMessage: postnotification.TriggerAnalyticsMessage struct{PostID string}
  - unfolded_fields:
    - TriggerAnalyticsMessage.PostID: string
  - foreign_fields:
    - TriggerAnalyticsMessage:
      - MEDIA_DB.Media.PostID
      - POSTS_CACHE.key
      - POSTS_CACHE.value
      - POSTS_DB.Post.PostID
    - TriggerAnalyticsMessage.PostID:
      - MEDIA_DB.Media.PostID
      - POSTS_CACHE.key
      - POSTS_CACHE.value
      - POSTS_DB.Post.PostID

MEDIA_DB:
- type: NoSQLDatabase
- kind: MongoDB
- dependencies: []
- schema:
  - fields:
    - document: postnotification.Media struct{MediaID int64, PostID int64, Content string}
    - Media: postnotification.Media struct{MediaID int64, PostID int64, Content string}
  - unfolded_fields:
    - Media.MediaID: int64
    - Media.PostID: int64
    - Media.Content: string
  - foreign_fields: []

NOTIFICATIONS_QUEUE:
- type: Queue
- kind: RabbitMQ
- dependencies:
  - posts_cache
  - posts_db
  - media_db
  - analytics_queue
  - analytics_db
- schema:
  - fields:
    - message: postnotification.Message struct{ReqID string, PostID string, Timestamp string}
    - Message: postnotification.Message struct{ReqID string, PostID string, Timestamp string}
  - unfolded_fields:
    - Message.ReqID: string
    - Message.PostID: string
    - Message.Timestamp: string
  - foreign_fields:
    - Message:
      - ANALYTICS_DB.Analytics.PostID
      - ANALYTICS_QUEUE.TriggerAnalyticsMessage.PostID
      - MEDIA_DB.Media.PostID
      - POSTS_CACHE.key
      - POSTS_CACHE.value
      - POSTS_DB.Post.PostID
      - POSTS_DB.Post.ReqID
    - Message.ReqID:
      - POSTS_CACHE.key
      - POSTS_CACHE.value
      - POSTS_DB.Post.ReqID
    - Message.PostID:
      - ANALYTICS_DB.Analytics.PostID
      - ANALYTICS_QUEUE.TriggerAnalyticsMessage.PostID
      - MEDIA_DB.Media.PostID
      - POSTS_CACHE.key
      - POSTS_CACHE.value
      - POSTS_DB.Post.PostID

POSTS_CACHE:
- type: Cache
- kind: Redis
- dependencies:
  - media_db
- schema:
  - fields:
    - key: string
    - value: Post
  - unfolded_fields: []
  - foreign_fields:
    - key:
      - MEDIA_DB.Media.PostID
    - value:
      - MEDIA_DB.Media.PostID

POSTS_DB:
- type: NoSQLDatabase
- kind: MongoDB
- dependencies:
  - posts_cache
  - media_db
- schema:
  - fields:
    - document: postnotification.Post struct{ReqID int64, PostID int64, MediaID int64, Text string, Mentions []string, Timestamp int64, Creator postnotification.Creator struct{Username string}}
    - Post: postnotification.Post struct{ReqID int64, PostID int64, MediaID int64, Text string, Mentions []string, Timestamp int64, Creator postnotification.Creator struct{Username string}}
  - unfolded_fields:
    - Post.ReqID: int64
    - Post.PostID: int64
    - Post.MediaID: int64
    - Post.Text: string
    - Post.Mentions: '[]string'
    - Post.Timestamp: int64
    - Post.Creator: postnotification.Creator struct{Username string}
    - Post.Creator.Username: string
  - foreign_fields:
    - Post:
      - MEDIA_DB.Media.PostID
      - POSTS_CACHE.key
      - POSTS_CACHE.value
    - Post.ReqID:
      - POSTS_CACHE.key
      - POSTS_CACHE.value
    - Post.PostID:
      - MEDIA_DB.Media.PostID
      - POSTS_CACHE.key
      - POSTS_CACHE.value
    - Post.Text:
      - POSTS_CACHE.key
      - POSTS_CACHE.value
    - Post.Mentions:
      - POSTS_CACHE.key
      - POSTS_CACHE.value
    - Post.Timestamp:
      - POSTS_CACHE.key
      - POSTS_CACHE.value
    - Post.Creator:
      - POSTS_CACHE.key
      - POSTS_CACHE.value
    - Post.Creator.Username:
      - POSTS_CACHE.key
      - POSTS_CACHE.value

TIMELINE_CACHE:
- type: Cache
- kind: Redis
- dependencies:
  - posts_db
  - posts_cache
  - notifications_queue
  - media_db
  - analytics_queue
  - analytics_db
- schema:
  - fields:
    - key: string
    - value: Timeline
  - unfolded_fields: []
  - foreign_fields:
    - key:
      - NOTIFICATIONS_QUEUE.Message.ReqID
      - POSTS_CACHE.key
      - POSTS_CACHE.value
      - POSTS_DB.Post.ReqID
    - value:
      - ANALYTICS_DB.Analytics.PostID
      - ANALYTICS_QUEUE.TriggerAnalyticsMessage.PostID
      - MEDIA_DB.Media.PostID
      - NOTIFICATIONS_QUEUE.Message.PostID
      - NOTIFICATIONS_QUEUE.Message.ReqID
      - POSTS_CACHE.key
      - POSTS_CACHE.value
      - POSTS_DB.Post.PostID
      - POSTS_DB.Post.ReqID
