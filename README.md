# Microservices Consistency Analyzer

**Microservices Consistency Analyzer** is a toolkit that statically analyzes microservice applications written in frameworks (e.g. [Service Weaver](https://dl.acm.org/doi/10.1145/3593856.3595909) and [Blueprint](https://dl.acm.org/doi/10.1145/3600006.3613138)) that introduce a new modular approach for building and deploying microservices. The goal is to detect potential consistency violations at configuration time by leveraging the global view over the entire application, including the relationship between services and operations to underlying databases. At the moment, the toolkit supports Blueprint ([code](https://github.com/Blueprint-uServices/blueprint)), and is capable of capturing *cross-service inconsistencies*, introduced in [Antipode](https://dl.acm.org/doi/10.1145/3600006.3613176). In the future, we aim to support a wide variety of similar frameworks and capture additional consistency anomalies.

## Getting Started

After cloning the repository, fetch submodules for `blueprint` repository

```zsh
cd ms-consistency-analyzer
git submodule update --init --recursive
```

## Requirements

- [Golang](https://go.dev/doc/install) >= 1.22.2

## How to Run

Available applications:
- `postnotification`
- `foobar`

```zsh
go run main.go -app=postnotification
go run main.go -app=footbar

source ~/.venv/bin/activate
pip3 install -r requirements.txt
./graphs.py --app shopping_simple
```

## Structure

The toolkit takes as input applications in the `examples` folder from the [blueprint](https://github.com/mafaldacf/blueprint) git module forked from the original repository.

The representation of the application and the abstract graph are saved in the `assets` folder in JSON format.

The source code is located in the `pkg` folder, divided into the following modules: `abstractgraph`, `app`, `controlflow`, `frameworks`, `logger`, `service`, `types`, `utils`.

| Module                    | Description |
| --------------------------| ---------- |
|                           |            |
| **Application**           | Initializes the application and registers **service nodes** and **database instances** with the application spec generated by Blueprint       |
| **Frameworks**            | Contains utilities specific to each framework. In the context of Blueprint, it contains (i) helper functions to compute the service spec from Intermediate Representation (IR), and (ii) methods that define backends like databases and queues       |
| **Service**               | Parses the **abstract syntax tree (ast)** of each service, capturing all service, database, or even internal calls within each exposed method       |
| **Control Flow Graph**    | Parses the **control flow graph (cfg)** of each service, capturing all dependencies in declared and assigned variables within each exposed method block from service, database, or internal calls       |
| **Abstract Graph**        | Generates the final abstract graph containing nodes (**abstract service calls** or **abstract database calls**) and edges representing the relationship and order between service and database calls, including queue handlers triggered by publishers       |
