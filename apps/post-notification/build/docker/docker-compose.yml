
version: '3'
services:

  frontend_container:
    build:
      context: frontend_container
      dockerfile: ./Dockerfile
    hostname: frontend_container
    expose:
     - "2000"
    ports:
     - "${FRONTEND_HTTP_BIND_ADDR?frontend.http.bind_addr must be set by the calling environment}:2000"
    environment:
     - FRONTEND_HTTP_BIND_ADDR=0.0.0.0:2000
     - NOTIFICATION_QUEUE_DIAL_ADDR=notification_queue_ctr:5672
     - STORAGE_SERVICE_SERVICE_THRIFT_DIAL_ADDR=storage_service_container:2000
    restart: always

  notification_queue_ctr:
    image: rabbitmq:3.8
    hostname: notification_queue_ctr
    expose:
     - "5672"
    ports:
     - "${NOTIFICATION_QUEUE_BIND_ADDR?notification_queue.bind_addr must be set by the calling environment}:5672"
    environment:
     - RABBITMQ_DEFAULT_HOST=/
     - RABBITMQ_ERLANG_COOKIE=notification_queue.ctr-RABBITMQ
    restart: always

  notify_service_container:
    build:
      context: notify_service_container
      dockerfile: ./Dockerfile
    hostname: notify_service_container
    environment:
     - NOTIFICATION_QUEUE_DIAL_ADDR=notification_queue_ctr:5672
     - STORAGE_SERVICE_SERVICE_THRIFT_DIAL_ADDR=storage_service_container:2000
    restart: always

  post_db_ctr:
    image: mongo
    hostname: post_db_ctr
    expose:
     - "27017"
    ports:
     - "${POST_DB_BIND_ADDR?post_db.bind_addr must be set by the calling environment}:27017"
    restart: always

  storage_service_container:
    build:
      context: storage_service_container
      dockerfile: ./Dockerfile
    hostname: storage_service_container
    expose:
     - "2000"
    ports:
     - "${STORAGE_SERVICE_SERVICE_THRIFT_BIND_ADDR?storage_service_service.thrift.bind_addr must be set by the calling environment}:2000"
    environment:
     - POST_DB_DIAL_ADDR=post_db_ctr:27017
     - STORAGE_SERVICE_SERVICE_THRIFT_BIND_ADDR=0.0.0.0:2000
    restart: always

